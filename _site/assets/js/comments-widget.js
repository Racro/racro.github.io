!function(){"use strict";function e(e){const t=new Date(e),n=new Date-t,o=Math.floor(n/6e4),m=Math.floor(n/36e5),s=Math.floor(n/864e5);return o<1?"just now":o<60?`${o} minute${o>1?"s":""} ago`:m<24?`${m} hour${m>1?"s":""} ago`:s<7?`${s} day${s>1?"s":""} ago`:t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function t(t){const o=document.getElementById("comments-container");if(!o)return;if(0===t.length)return void(o.innerHTML='<p class="comments-empty">No comments yet. Be the first to share your thoughts!</p>');const m=t.map((t=>`\n      <div class="comment-item">\n        <div class="comment-header">\n          <strong class="comment-author">${n(t.name)}</strong>\n          <span class="comment-date">${e(t.timestamp)}</span>\n        </div>\n        <div class="comment-body">${n(t.comment).replace(/\n/g,"<br>")}</div>\n      </div>\n    `)).join("");o.innerHTML=m}function n(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async function o(){try{const e=await fetch(`${a}?page=${encodeURIComponent(c)}`);if(!e.ok)throw new Error("Failed to load comments");t(await e.json())}catch(e){const t=document.getElementById("comments-container");t&&(t.innerHTML='<p class="comments-error">Unable to load comments. Please try again later.</p>')}}async function m(e){const t=document.getElementById("comment-submit"),n=t?t.textContent:"Submit";t&&(t.disabled=!0,t.textContent="Submitting...");try{const t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:c,name:e.get("name")||"Anonymous",email:e.get("email")||"",comment:e.get("comment")})});let n;try{n=await t.json()}catch(e){throw new Error("Invalid response from server")}if(!t.ok)throw new Error(n.error||"Failed to submit comment");if(!n.success)throw new Error(n.error||"Comment may not have been saved");{const e=document.getElementById("comment-form");e&&e.reset(),await o();const t=document.getElementById("comment-message");t&&(t.textContent="Comment submitted successfully!",t.className="comment-message success",setTimeout((()=>{t.textContent="",t.className="comment-message"}),3e3))}}catch(e){const t=document.getElementById("comment-message");t&&(t.textContent=e.message||"Failed to submit comment. Please try again.",t.className="comment-message error"),setTimeout((()=>{o()}),1e3)}finally{t&&(t.disabled=!1,t.textContent=n)}}function s(){o();const e=document.getElementById("comment-form");e&&e.addEventListener("submit",(async t=>{t.preventDefault();const n=new FormData(e),o=n.get("comment");if(!o||o.trim().length<3){const e=document.getElementById("comment-message");e&&(e.textContent="Please enter a comment (at least 3 characters).",e.className="comment-message error")}else await m(n)}))}const a=window.COMMENTS_CONFIG?.workerUrl||"";if(!a){const e=document.getElementById("comments-container");return void(e&&(e.innerHTML='<p class="comments-error">Comments system not configured. Please set cloudflare_worker_url in _config.yml</p>'))}const c=window.location.pathname;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()}();